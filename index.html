<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enzo Dialer Time Sheet</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://apis.google.com/js/api.js" async defer></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="loginModal" style="display: none;">
<div id="loginForm">
<h2>Login / Register</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<p id="info">Accounts inactive for 6 months will be deleted.</p>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
<p id="message"></p>
</div>
</div>

<div id="colorPickerModal" class="color-picker-modal">
<div class="color-picker-box">
<h3>Customize Theme Color</h3>
<p>Choose a primary color for the application</p>
<input type="color" id="colorPicker" value="#1e3a8a">
<button class="apply-btn" onclick="applyCustomColor()">Apply</button>
<button class="cancel-btn" onclick="closeColorPicker()">Cancel</button>
</div>
</div>

<div id="confirmDialog" class="confirm-dialog">
<div class="confirm-box">
<h3 id="confirmTitle">Confirm Action</h3>
<p id="confirmMessage"></p>
<button class="confirm-btn" onclick="confirmAction()">Confirm</button>
<button class="cancel-btn" onclick="cancelAction()">Cancel</button>
</div>
</div>

<div id="loadingOverlay" class="loading-overlay">
<div class="loader"></div>
</div>

<div class="container" id="appContainer" style="display: block;">
<div class="header">
<div class="header-logo">ED</div>
<div class="header-title">
  <h1>Enzo Dialer Time Sheet</h1>
  <p>Professional Time Tracking Solution</p>
</div>
<div class="header-buttons">
  <button class="login-btn" id="loginBtn" onclick="showLoginModal()">ğŸ”‘ Login/Register</button>
  <button class="color-customize-btn" onclick="showColorPicker()">ğŸ¨ Customize Color</button>
  <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ Dark Mode</button>
</div>
</div>

<div class="settings-bar">
<div class="input-group">
  <label>Employee Name</label>
  <input type="text" id="employeeName" value="Enzo" placeholder="Enter name">
</div>
<div class="input-group">
  <label>Employee Role</label>
  <input type="text" id="employeeRole" value="Employee" placeholder="Enter role">
</div>
<div class="input-group">
  <label>Hourly Rate (USD)</label>
  <input type="number" id="hourlyRate" value="0" step="0.01" min="0">
</div>
<div class="input-group">
  <label>Bonus (USD)</label>
  <input type="number" id="bonus" value="0" step="0.01" min="0">
</div>
<div class="input-group">
  <label>Payment Options</label>
  <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
    <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; cursor: pointer;">
      <input type="checkbox" id="includeBreaks" onchange="updateTotals()" style="width: auto;">
      Include breaks in payment
    </label>
  </div>
</div>
</div>

<div class="main-content">
<div class="table-container">
  <table id="timeSheet">
    <thead>
      <tr>
        <th>Date</th>
        <th>Day Off</th>
        <th>Work Hours</th>
        <th>Break Hours</th>
        <th>Total Hours</th>
        <th>Amount</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="summary-section">
  <div class="summary-grid">
    <div class="summary-item">
      <h3>Total Working Hours</h3>
      <div class="value" id="totalWorkingHours">0.00</div>
    </div>
    <div class="summary-item">
      <h3>Total Break Hours</h3>
      <div class="value" id="totalBreakHours">0.00</div>
    </div>
    <div class="summary-item">
      <h3>Total Hours</h3>
      <div class="value" id="totalHours">0.00</div>
    </div>
    <div class="summary-item">
      <h3>Base Pay</h3>
      <div class="value" id="basePay">$0.00</div>
    </div>
  </div>
  <div class="grand-total">
    <h2>Grand Total: $<span id="totalValue">0.00</span></h2>
  </div>
</div>

<div class="controls">
  <div class="control-group">
    <input type="date" id="selectedDate" value="">
    <button class="btn btn-primary" onclick="addDay()">ğŸ“… Add Day</button>
  </div>
  <div class="control-group">
    <input type="date" id="weekStartDate" value="">
    <button class="btn btn-primary" onclick="addWeek()">ğŸ“† Add Week</button>
  </div>
  <button class="btn btn-success" onclick="saveHistory()">ğŸ’¾ Save History</button>
  <button class="btn btn-warning" onclick="downloadPDF()">ğŸ“„ Export PDF</button>
  <button class="btn btn-info" onclick="downloadCSV()">ğŸ“Š Export CSV</button>
  <button class="btn btn-info" onclick="downloadXLSX()">ğŸ“ˆ Export XLSX</button>
  <button class="btn btn-info" onclick="emailData()">ğŸ“§ Email Report</button>
  <button class="btn btn-info" onclick="exportJSON()">ğŸ–´ Export JSON</button>
  <button class="btn btn-info" onclick="document.getElementById('importJSONFile').click()">â¬† Import JSON</button>
  <input type="file" id="importJSONFile" style="display:none" accept=".json" onchange="importJSON(this.files[0])">
  <button class="btn btn-info" onclick="exportToDrive()">Export to Drive</button>
  <button class="btn btn-info" onclick="importFromDrive()">Import from Drive</button>
  <button class="btn btn-info" onclick="document.getElementById('insightfulFile').click()">Upload Insightful Data</button>
  <input type="file" id="insightfulFile" style="display:none" accept=".xlsx,.xls,.csv" onchange="processInsightfulFile(this.files[0])">
  <button class="btn btn-warning" onclick="showConfirmDialog('clearAll', 'Are you sure you want to clear all entries? This cannot be undone.')">ğŸ—‘ï¸ Clear All</button>
  <button class="btn btn-warning" id="logoutBtn" onclick="logout()" style="display: none;">ğŸšª Logout</button>
</div>

<div class="history-section">
  <h2>ğŸ“‹ Payment History</h2>
  <div id="history" class="history-list"></div>
</div>
</div>

<div class="footer">
<p>Enzo Dialer Time Sheet &copy; 2025</p>
<p>Last Updated: <span id="lastUpdated">Not yet saved</span></p>
<p>Contact: support@enzodialer.com | Company: Enzo Dialer</p>
</div>
</div>


<script type="module">
  import { registerUser, loginUser, logoutUser, initSupabase } from './js/database.js';
  window.register = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const employeeName = document.getElementById('employee-name').value;
    const employeeRole = document.getElementById('employee-role').value;
    const hourlyRate = document.getElementById('hourly-rate').value;
    const bonus = document.getElementById('bonus').value;
    await registerUser(email, password, employeeName, employeeRole, hourlyRate, bonus);
  };
  window.login = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    await loginUser(email, password);
  };
  window.logout = async () => {
    await logoutUser();
  };
  initSupabase();
</script>

<script src="js/init.js"></script>
<script src="js/auth.js"></script>
<script src="js/theme.js"></script>
<script src="js/timesheet.js"></script>
<script src="js/export.js"></script>
<script src="js/drive.js"></script>
<script src="js/database.js" type="module"></script>
</body>
</html>